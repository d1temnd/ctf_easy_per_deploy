# Универсальный деплоер для CTF-заданий

[English version (Английская версия)](README.md)

Гибкое контейнеризированное решение для развертывания заданий Capture The Flag (CTF) с изолированными экземплярами для каждого участника.

## Обзор

Эта система предоставляет простой способ развертывания контейнеризированных CTF-заданий для соревнований, тренировок или образовательных целей. Каждый участник получает собственный изолированный экземпляр контейнера со следующими возможностями:

- Автоматическое истечение срока действия
- Возможность продления сессии
- Возможность перезапуска
- Независимые экземпляры для предотвращения взаимного влияния между участниками

## Компоненты

Система состоит из двух основных частей:

1. **Flask-приложение (Деплоер)**: Веб-интерфейс для управления экземплярами заданий
2. **Контейнер с заданием**: Docker-контейнер с фактическим CTF-заданием (может быть настроен)

## Быстрый старт

### Требования

- Установленные Docker и Docker Compose
- Git (для клонирования репозитория)

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/ctf_deployer.git
   cd ctf_deployer
   ```

2. Настройте ваше задание:
   - Обновите задание в `generic_ctf_task/` или создайте свое собственное
   - Измените файл `.env` с вашими настройками
   
3. Соберите и запустите деплоер:
   ```bash
   docker-compose up --build
   ```

4. Получите доступ к деплоеру по адресу `http://localhost:6664`

## Как это работает

### Жизненный цикл контейнера

1. Пользователь запрашивает новый экземпляр через веб-интерфейс
2. Система выделяет порт и развертывает изолированный Docker-контейнер
3. Пользователь получает доступ к своему заданию на назначенном порту
4. Контейнер автоматически истекает после настроенного времени (по умолчанию: 30 минут)
5. Пользователь может продлить, перезапустить или вручную остановить свой экземпляр

### Функции безопасности

- Каждый участник получает изолированный контейнер
- Ограничение скорости предотвращает злоупотребление (максимальное количество контейнеров на IP)
- Автоматическая очистка истекших контейнеров
- Отслеживание сессий с использованием cookie-файлов браузера

## Конфигурация

Основная конфигурация выполняется через файл `.env`:

```
# Конфигурация задания
LEAVE_TIME=1800            # Время жизни контейнера в секундах (30 минут)
ADD_TIME=600               # Время продления в секундах (10 минут)
IMAGES_NAME=localhost/generic_ctf_task:latest  # Docker-образ для задания
FLAG=CTF{your_flag_here}   # Флаг для задания
PORT_IN_CONTAINER=80       # Порт, открываемый контейнером задания
START_RANGE=9000           # Начальный диапазон портов для маппинга
STOP_RANGE=10000           # Конечный диапазон портов для маппинга
DB_PATH=./data/containers.db  # Путь к базе данных

# Детали задания
CHALLENGE_TITLE=Название вашего задания
CHALLENGE_DESCRIPTION=Краткое описание вашего задания
```

## Создание собственного задания

Чтобы создать пользовательское задание:

1. Замените содержимое `generic_ctf_task/` своим заданием:
   - Настройте `Dockerfile` для сборки вашего задания
   - Убедитесь, что ваше приложение прослушивает порт, указанный в `PORT_IN_CONTAINER`
   - Убедитесь, что ваше приложение читает флаг из переменной окружения `FLAG`

2. Обновите файл `.env` с деталями вашего задания:
   - Установите подходящее название и описание
   - Настройте флаг
   - При необходимости отрегулируйте настройки времени

3. Пересоберите систему:
   ```bash
   docker-compose down
   docker-compose up --build
   ```

### Пример структуры задания

Самая простая структура задания:

```
generic_ctf_task/
├── Dockerfile          # Как собрать ваше задание
└── [файлы задания]     # Ваши файлы задания
```

`Dockerfile` должен:
1. Настроить среду для вашего задания
2. Скопировать файлы задания в контейнер
3. Открыть правильный порт
4. Установить команду запуска

## Устранение неполадок

### Распространенные проблемы

- **Нет доступных портов**: Система достигла максимального количества одновременных контейнеров
- **Превышен лимит скорости**: Один IP создал слишком много экземпляров
- **Контейнер не запускается**: Проверьте логи Docker на наличие ошибок
- **Невозможно получить доступ к заданию**: Убедитесь, что задание запущено на правильном порту

### Логи

Для просмотра логов:

```bash
# Просмотр логов деплоера
docker-compose logs flask_app

# Просмотр логов конкретного контейнера задания
docker logs [container_id]
```

## Технические детали

- **Деплоер**: Веб-приложение Flask
- **База данных**: SQLite (хранится в директории data)
- **Управление контейнерами**: Docker Python SDK
- **Фронтенд**: Bootstrap и ванильный JavaScript

## Лицензия

[Лицензия MIT](LICENSE)

## Содействие проекту

Вклады приветствуются! Пожалуйста, не стесняйтесь отправлять Pull Request.
